{
  "hash": "56ff24c0212beda4fb369caba4125b5f",
  "result": {
    "markdown": "---\ntitle: \"Data Acquisition\"\nauthor: \"Tommy Weber\"\n\nnumber-sections: true\nnumber-depth: 5\n---\n\n\n# Web API\n## Adding Libraries\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-1_9fbdfb62b804c23251394fa51270fd06'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(httr)\nlibrary(glue)\nlibrary(jsonlite)\n```\n:::\n\n\n## Get Data from API\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-2_fd1063fc43a56095ca9390341bb6219d'}\n\n```{.r .cell-code}\nbase_url <- \"https://archive-api.open-meteo.com\"\nharburg_lat_lon_query <- \"latitude=53.4608&longitude=9.9836\"\ndata_url <- glue(\"/v1/era5?{harburg_lat_lon_query}&start_date=2023-04-24&end_date=2023-04-26&hourly=temperature_2m\")\nresp <- GET(glue(\"{base_url}{data_url}\"))\nstop_for_status(resp)\nresp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Response [https://archive-api.open-meteo.com/v1/era5?latitude=53.4608&longitude=9.9836&start_date=2023-04-24&end_date=2023-04-26&hourly=temperature_2m]\n#>   Date: 2023-05-03 13:09\n#>   Status: 200\n#>   Content-Type: application/json; charset=utf-8\n#>   Size: 1.93 kB\n```\n:::\n:::\n\n## Convert received Data to List\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-3_6654dfefa59561033bb45df0aa5b599c'}\n\n```{.r .cell-code}\nweather_data_list <- resp %>% \n  .$content %>% \n  rawToChar() %>% \n  fromJSON()\n```\n:::\n\n\n## Convert List to Tibble\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-4_5f59907f131253a8e0570eafbcf567ac'}\n\n```{.r .cell-code}\ntemperature_data_tbl <- weather_data_list %>% \n  .$hourly %>% \n  as_tibble()\n\ntemperature_data_tbl %>% head(10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"time\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"temperature_2m\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2023-04-24T00:00\",\"2\":\"11.5\"},{\"1\":\"2023-04-24T01:00\",\"2\":\"11.2\"},{\"1\":\"2023-04-24T02:00\",\"2\":\"11.1\"},{\"1\":\"2023-04-24T03:00\",\"2\":\"11.0\"},{\"1\":\"2023-04-24T04:00\",\"2\":\"10.6\"},{\"1\":\"2023-04-24T05:00\",\"2\":\"10.3\"},{\"1\":\"2023-04-24T06:00\",\"2\":\"10.4\"},{\"1\":\"2023-04-24T07:00\",\"2\":\"10.9\"},{\"1\":\"2023-04-24T08:00\",\"2\":\"11.6\"},{\"1\":\"2023-04-24T09:00\",\"2\":\"12.3\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Visualize the Data\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-5_eead194eba2d7da21b37a59ef9e05a44'}\n\n```{.r .cell-code}\ntemperature_data_tbl %>% \n  ggplot(aes(x = time, y = temperature_2m)) +\n  geom_point() +\n  scale_x_discrete(guide = guide_axis(check.overlap = TRUE)) +\n  theme(plot.margin = margin(10,40,10,40)) + \n  labs(\n    title    = \"Temperature Curve\",\n    subtitle = \"24.04.2023 - 26.04.2023\",\n    x = \"\",\n    y = \"Temperature in Â°C\"\n  )\n```\n\n::: {.cell-output-display}\n![](02_data_acquisition_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n# Web Scraping\n## Adding Libraries\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-6_fc5adbaf38a1bbe131276e7bd08c7d5b'}\n\n```{.r .cell-code}\nlibrary(rvest)\nlibrary(xopen)\n```\n:::\n\n\n## Read in the HTML\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-7_261627529a949e8f00b7100eb1291647'}\n\n```{.r .cell-code}\n# The url to the Backroad category of the Gravel family\nurl_category <- \"https://www.rosebikes.de/fahrr%C3%A4der/gravel/backroad\"\nxopen(url_category)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Running cmd /c start \"\\\"\\\"\" /b \\\n#>   \"https://www.rosebikes.de/fahrr%C3%A4der/gravel/backroad\"\n```\n:::\n\n```{.r .cell-code}\n# Read in the HTML for the category site\nhtml_category <- read_html(url_category)\n```\n:::\n\n\n## Scrape the Names and Prices\n\nAll models are displayed in a custom html-tag\ncalled 'catalog-category-model'.\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-8_630c07e25a26a94fb94ac6e3f3da569d'}\n\n```{.r .cell-code}\n# Web scrape the model names\nbike_model_name_tbl <- html_category %>%\n  html_nodes(css = \"catalog-category-model\") %>%\n  html_nodes(css = \".basic-headline__title\") %>%\n  html_text() %>%\n  enframe(name = \"position\", value = \"model_name\")\n\nbike_model_name_tbl\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"position\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"model_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"BACKROAD GRX RX600 1x11\"},{\"1\":\"2\",\"2\":\"BACKROAD GRX RX810 1x11\"},{\"1\":\"3\",\"2\":\"BACKROAD Rival eTap AXS XPLR 1X12\"},{\"1\":\"4\",\"2\":\"BACKROAD GRX RX810 Di2 1X11\"},{\"1\":\"5\",\"2\":\"BACKROAD AXS MULLET BUILD\"},{\"1\":\"6\",\"2\":\"BACKROAD Force eTap AXS XPLR 1X12\"},{\"1\":\"7\",\"2\":\"BACKROAD GRX RX600\"},{\"1\":\"8\",\"2\":\"BACKROAD GRX RX810\"},{\"1\":\"9\",\"2\":\"BACKROAD GRX RX810 Di2\"},{\"1\":\"10\",\"2\":\"BACKROAD CLASSIFIED 2x11\"},{\"1\":\"11\",\"2\":\"BACKROAD GRX810 RANDONNEUR\"},{\"1\":\"12\",\"2\":\"BACKROAD GRX RX600 1x11\"},{\"1\":\"13\",\"2\":\"BACKROAD GRX RX600\"},{\"1\":\"14\",\"2\":\"BACKROAD GRX RX810 1x11\"},{\"1\":\"15\",\"2\":\"BACKROAD GRX RX810\"},{\"1\":\"16\",\"2\":\"BACKROAD Rival eTap AXS XPLR 1X12\"},{\"1\":\"17\",\"2\":\"BACKROAD GRX810 RANDONNEUR\"},{\"1\":\"18\",\"2\":\"BACKROAD GRX RX810 Di2 1X11\"},{\"1\":\"19\",\"2\":\"BACKROAD GRX RX810 Di2\"},{\"1\":\"20\",\"2\":\"BACKROAD AXS MULLET BUILD\"},{\"1\":\"21\",\"2\":\"BACKROAD Force eTap AXS XPLR 1X12\"},{\"1\":\"22\",\"2\":\"BACKROAD CLASSIFIED 2x11\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Web scrape the model prices\nbike_model_price_tbl <- html_category %>%\n  html_nodes(css = \"catalog-category-model\") %>%\n  html_nodes(css = \".product-tile-price__current-value\") %>%\n  html_text() %>%\n  parse_number() %>%\n  enframe(name = \"position\", value = \"price\")\n\nbike_model_price_tbl\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"position\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"price\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"2.499\"},{\"1\":\"2\",\"2\":\"2.999\"},{\"1\":\"3\",\"2\":\"3.299\"},{\"1\":\"4\",\"2\":\"3.499\"},{\"1\":\"5\",\"2\":\"3.999\"},{\"1\":\"6\",\"2\":\"3.999\"},{\"1\":\"7\",\"2\":\"2.499\"},{\"1\":\"8\",\"2\":\"2.999\"},{\"1\":\"9\",\"2\":\"3.599\"},{\"1\":\"10\",\"2\":\"4.999\"},{\"1\":\"11\",\"2\":\"3.299\"},{\"1\":\"12\",\"2\":\"2.499\"},{\"1\":\"13\",\"2\":\"2.499\"},{\"1\":\"14\",\"2\":\"2.999\"},{\"1\":\"15\",\"2\":\"2.999\"},{\"1\":\"16\",\"2\":\"3.299\"},{\"1\":\"17\",\"2\":\"3.299\"},{\"1\":\"18\",\"2\":\"3.499\"},{\"1\":\"19\",\"2\":\"3.599\"},{\"1\":\"20\",\"2\":\"3.999\"},{\"1\":\"21\",\"2\":\"3.999\"},{\"1\":\"22\",\"2\":\"4.999\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Combine the Data\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-9_ae1e7595bb3578c1ab18bb6f7a0aa007'}\n\n```{.r .cell-code}\nbike_model_tbl <- bike_model_name_tbl %>%\n  left_join(bike_model_price_tbl, by = join_by(position))\n\nbike_model_tbl %>% head(10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"position\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"model_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"price\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"BACKROAD GRX RX600 1x11\",\"3\":\"2.499\"},{\"1\":\"2\",\"2\":\"BACKROAD GRX RX810 1x11\",\"3\":\"2.999\"},{\"1\":\"3\",\"2\":\"BACKROAD Rival eTap AXS XPLR 1X12\",\"3\":\"3.299\"},{\"1\":\"4\",\"2\":\"BACKROAD GRX RX810 Di2 1X11\",\"3\":\"3.499\"},{\"1\":\"5\",\"2\":\"BACKROAD AXS MULLET BUILD\",\"3\":\"3.999\"},{\"1\":\"6\",\"2\":\"BACKROAD Force eTap AXS XPLR 1X12\",\"3\":\"3.999\"},{\"1\":\"7\",\"2\":\"BACKROAD GRX RX600\",\"3\":\"2.499\"},{\"1\":\"8\",\"2\":\"BACKROAD GRX RX810\",\"3\":\"2.999\"},{\"1\":\"9\",\"2\":\"BACKROAD GRX RX810 Di2\",\"3\":\"3.599\"},{\"1\":\"10\",\"2\":\"BACKROAD CLASSIFIED 2x11\",\"3\":\"4.999\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Remove Duplicates\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-10_ed6086c19681334d338072fead2474a6'}\n\n```{.r .cell-code}\nbike_model_tbl %>%\n  group_by(model_name) %>%\n  # Since the price should be the same, choose the first one.\n  summarise(price = price[1])\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"model_name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"price\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"BACKROAD AXS MULLET BUILD\",\"2\":\"3.999\"},{\"1\":\"BACKROAD CLASSIFIED 2x11\",\"2\":\"4.999\"},{\"1\":\"BACKROAD Force eTap AXS XPLR 1X12\",\"2\":\"3.999\"},{\"1\":\"BACKROAD GRX RX600\",\"2\":\"2.499\"},{\"1\":\"BACKROAD GRX RX600 1x11\",\"2\":\"2.499\"},{\"1\":\"BACKROAD GRX RX810\",\"2\":\"2.999\"},{\"1\":\"BACKROAD GRX RX810 1x11\",\"2\":\"2.999\"},{\"1\":\"BACKROAD GRX RX810 Di2\",\"2\":\"3.599\"},{\"1\":\"BACKROAD GRX RX810 Di2 1X11\",\"2\":\"3.499\"},{\"1\":\"BACKROAD GRX810 RANDONNEUR\",\"2\":\"3.299\"},{\"1\":\"BACKROAD Rival eTap AXS XPLR 1X12\",\"2\":\"3.299\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}